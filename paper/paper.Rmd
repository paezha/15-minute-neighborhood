---
title: "Which fifteen-minutes neighborhoods are dead-ends? An analysis of the network attributes of fifteen-minute pedsheds"
author:
  - name: Author One
    email: a1@example.com
    affiliation: University One
    correspondingauthor: true
    footnote: 1
  - name: Author Two
    email: a2@example.com
    affiliation: University Two
  - name: Author Three
    email: a3@example.com
    affiliation: University One
    footnote: 2
  - name: Author Four
    email: a4@example.com
    affiliation: University One
    footnote: 2
address:
  - code: University One
    organization: Department
    addressline: 1 main street
    city: City
    state: State
    postcode: 123456
    country: Country
  - code: University Two
    organization: Department
    addressline: 2 main street
    postcode: 2054
    city: City
    country: Country
footnote:
  - code: 1
    text: "This is the first author footnote."
  - code: 2
    text: "Another author footnote."
abstract: |
  Fifteen-minutes neihborhoods, a form of normative chronourbanism based on cumulative opportunities, has aroused interest as a way to reduce the need for motorized travel, and increase the livability, convenience, and health of the public. At the core of this concept is a pedshed, an area defined by the walkable isochrone of the eponymous fifteen minutes. As the idea of fifteen-minutes neighborhoods develops traction in policy and planning circles, it seems timely to revisit the way street network design can support—or obstruct—the stated goal of preserving or creating walkable neighborhoods with essential amenities. In this paper we examine a sample ($n=834$) of fifteen-minutes pedsheds in Hamilton, a medium-sized city in Canada, and how their sizes relate to the attributes of the transportation network. The analysis reveals that network design in suburban Hamilton conspires against the creating of fifteen-minutes neighborhoods. Much of urban Hamilton, in contrast, already has the characteristics of fifteen-minutes neighborhoods. The research points to elements of network design that can help to discriminate between candidate neighborhoods and dead-ends, and that can provide parameters for the design of new developments.

keywords: 
  - Fifteen-minutes neighborhoods
  - Pedshed
  - Walkability
  - Accessibility
  - Network analysis
journal: "Sustainable Cities and Society"
date: "`r Sys.Date()`"
classoption: preprint, 3p, authoryear
bibliography:
  - "`r system('kpsewhich ../bibliography/bibliography.bib', intern=TRUE)`"
linenumbers: false
numbersections: true
# Use a CSL with `citation_package = "default"`
# csl: https://www.zotero.org/styles/elsevier-harvard
output: 
  rticles::elsevier_article:
    keep_tex: true
    citation_package: natbib
---

```{r chunk-setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)
```

```{r load-packages}
library(broom) # Convert Statistical Objects into Tidy Tibbles
library(dplyr) # A Grammar of Data Manipulation
library(evtree) # Evolutionary Learning of Globally Optimal Trees
library(ggparty) # 'ggplot' Visualizations for the 'partykit' Package
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(glue) # Interpreted String Literals
library(gt) # Easily Create Presentation-Ready Display Tables
library(rpart) # Recursive Partitioning and Regression Trees
library(rpart.plot) # Plot 'rpart' Models: An Enhanced Version of 'plot.rpart'
library(patchwork) # The Composer of Plots
library(partykit)
library(tidyr) # Tidy Messy Data
library(tree) # Classification and Regression Trees
library(sf) # Simple Features for R
library(skimr) # Compact and Flexible Summaries of Data
library(SOMbrero) # SOM Bound to Realize Euclidean and Relational Outputs
library(stringr) # Simple, Consistent Wrappers for Common String Operations
library(units) # Measurement Units for R Vectors
library(vaccHamilton) # A Data Package to Estimate Accessibility of Vaccination Sites in Hamilton, ON
```

```{r load-data}
 # From package vaccHamilton
data("urban_types")

# Analysis-ready data. See notebooks in folder data-raw for details
load(file = glue::glue(here::here(),
                       "/data/amenities_walkshed_da.rda"))
load(file = glue::glue(here::here(),
                       "/data/hamilton_net.rda"))
load(file = glue::glue(here::here(),
                       "/data/urban_hammer_da.rda"))
load(file = glue::glue(here::here(),
                       "/data/walksheds_da.rda"))
load(file = glue::glue(here::here(),
                       "/data/walksheds_da_net_vars.rda"))
```



The aim is to train a classification tree to profile urban and suburban walksheds based on the attributes of the network. We need to drop 1 observation that has an NA in `transitivity`:

```{r}
d <- walksheds_da_net_vars |>
  select(-girth) |>
  drop_na() |>
  mutate(normalized_motifs_3 = motifs_3/n_edges,
         normalized_motifs_4 = motifs_4/n_edges)
```

```{r identify-network-characteristics-by-urban-type}
#seed1 <- 908544
set.seed(908544)
ev.tree <- evtree::evtree(Type ~ ., 
                data = d |> select(-c(GeoUID, 
                                      motifs_3, 
                                      motifs_4, 
                                      n_edges, 
                                      n_nodes)))

ct.tree <- partykit::cttree.treeree(Type ~ ., 
                data = d |> select(-c(GeoUID, 
                                      motifs_3, 
                                      motifs_4, 
                                      n_edges, 
                                      n_nodes)))

rpart.tree <- rpart::rpart(Type ~ ., 
                data = d |> select(-c(GeoUID, 
                                      motifs_3, 
                                      motifs_4, 
                                      n_edges, 
                                      n_nodes)))

tree.tree <- tree::tree(Type ~ ., 
                data = d |> select(-c(GeoUID, 
                                      motifs_3, 
                                      motifs_4, n_edges,
                                      n_nodes)))


```


```{r}
evtree.cm <- data.frame(obs = d$Type,
                        pred = predict(ev.tree, newdata = d)) |>
  mutate(obs = ifelse(obs == "Urban", 1, 0),
         pred = ifelse(pred == "Urban", 1, 0))

xtabs(obs ~ pred,
      data = evtree.cm)
```



```{r}
rpart.tree |>
  as.party() |>
ggparty() +
  geom_edge() +
  geom_edge_label(size = 2.5) +
  geom_node_label(aes(label = splitvar ),
                  id = "inner",
                  size = 2, nudge_y = -0.022)
```



# Introduction

> "Il faut oublier la traversée de Paris d'est en ouest en voiture"^[ "We must forget about crossing Paris from east to west by car"]. 
> --Anne Hidalgo

With this declaration during her reelection campaign in 2020, Anne Hidalgo brought international attention to the concept of walkable fifteen-minutes neighborhoods [@alimi2020]. 


<!-- 
Automotive retrofits in traditional city centers:

@bass2019automotive
-->

@knight2018walkable
@liu2022toward
@pozoukidou2021fifteen
@weng2019fifteen













# References {-}

